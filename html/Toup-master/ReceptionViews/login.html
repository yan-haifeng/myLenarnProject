<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../layui/css/layui.css">
    <link rel="stylesheet" href="../css/jquery.slider.css">
    <script src="../js/jquery.min.js"></script>
    <script src="../js/jquery.slider.min.js"></script>
    <script src="../layui/layui.all.js"></script>
    <title>登录</title>
</head>

<body>
    <div class="layui-content">
        <div class="layui-row">
            <div class="layui-card">
                <div class="layui-card-body">
                    <form class="layui-form" action="" id="login_form">
                        <div class="layui-form-item">
                                <input type="text" name="username" lay-verify="title" autocomplete="off" placeholder="请输入用户名"
                                    class="layui-input">
                        </div>
                        <div class="layui-form-item">
                                <input type="password" name="password" lay-verify="pass" placeholder="请输入密码"
                                    autocomplete="off" class="layui-input">
                        </div>
                        <div class="layui-form-item">
                                <div id="slider2" class="slider"></div>
                        </div>
                        <div class="layui-form-item">
                                <button class="layui-btn layui-btn-fluid layui-btn-disabled" id="login" >登录</button>
                        </div>
                    </form>
                    <a href="#" onclick="register()">注册</a>
                    <a href="#" style="float:right;">忘记密码</a>
                </div>
            </div>
        </div>
    </div>
</body>
<!-- 初始化各方法 -->
<script>
var layer = layui.layer;
var slidflag = false;
var index = parent.layer.getFrameIndex(window.name);
</script>
<!-- 滑块验证 -->
<script type="text/javascript">
    $("#slider2").slider({
        width: 300, // width
        height: 40, // height
        sliderBg: "rgb(134, 134, 131)", // 滑块背景颜色
        color: "#fff", // 文字颜色
        fontSize: 14, // 文字大小
        bgColor: "#33CC00", // 背景颜色
        textMsg: "按住滑块，拖拽验证", // 提示文字
        successMsg: "验证通过了哦", // 验证成功提示文字
        successColor: "white", // 滑块验证成功提示文字颜色
        time: 400, // 返回时间
        callback: function (result) { // 回调函数，true(成功),false(失败)
            if (result) {
                slidflag = true;
            }
        }
    });
</script>
<!-- 验证通过 -->
<script>
    setInterval(function () {
        if (slidflag) {
            // $("#register").get(0).setAttribute("type", "submit");
            $("#login").removeClass("layui-btn-disabled");
        } else {
            // $("#register").get(0).setAttribute("type", "button");
            $("#login").addClass("layui-btn-disabled");
        }
    }, 1000);
</script>
<!-- 登录提交 -->
<script>
    $(function () {
        $("#login").click(
            function () {
                if (slidflag) {
                    $.ajax({
                        type: 'POST',
                        dataType: 'json',
                        url: 'http://localhost:8080/toup/user/login',
                        data: $("#login_form").serializeArray(),
                        contentType: "application/x-www-form-urlencoded",
                        success: function (data) {
                            console.log(data);
                            if (data.code == 0) {
                                document.cookie = "userdata"=data.data;
                                //登录成功
                                parent.layer.msg('登录成功');
                                parent.layer.close(index);  
                                parent.window.location.reload();
                            }else{
                                //登录失败 显示msg信息
                                parent.layer.msg(data.msg);
                            }
                        }
                    });
                }
            }
        );
    });

</script>
<!-- 注册窗口 -->
<script type="text/javascript">
function register(){
    layui.use('layer', function () {
        parent.layer.open({
            type: 2,
            content: ['ReceptionViews/register.html','no'], //这里content是一个URL，如果你不想让iframe出现滚动条，你还可以content: ['http://sentsin.com', 'no']
            area: ['620px', '610px'],
            resize:false,
            shadeClose:true
        }); 
    });         
}
</script>
</html>