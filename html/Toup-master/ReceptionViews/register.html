<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" href="../layui/css/layui.css">
    <link rel="stylesheet" href="../css/jquery.slider.css">
    <script src="../js/jquery.min.js"></script>
    <script src="../js/jquery.slider.min.js"></script>
    <script src="../js/jquery.validate.min.js"></script>
    <script src="../js/messages_zh.js"></script>
    <script src="../js/methods_zh.js"></script>
    <script src="../layui/layui.all.js"></script>
    <title>注册</title>
</head>

<body>
    <div class="layui-content">
        <div class="layui-row">
            <div class="layui-card">
                <div class="layui-card-body">
                    <form class="layui-form" action="" method="POST" id="register_form">
                        <div class="layui-form-item">
                            <input type="text" name="username" autocomplete="off" placeholder="请输入用户名" class="layui-input">
                        </div>
                        <div class="layui-form-item">
                            <input type="password" name="password" placeholder="请输入密码" autocomplete="off" class="layui-input"
                                id="password">
                        </div>
                        <div class="layui-form-item">
                            <input type="password" name="aginpassword" placeholder="请确认密码" autocomplete="off" class="layui-input"
                                id="aginpassword">
                        </div>
                        <div class="layui-form-item">
                            <input type="text" name="name" placeholder="请输入姓名" class="layui-input">
                        </div>
                        <div class="layui-form-item">
                            <input type="text" name="phone" autocomplete="off" placeholder="请输入手机号" class="layui-input">
                        </div>
                        <div class="layui-form-item">
                            <input type="text" name="email" autocomplete="off" placeholder="请输入邮箱" class="layui-input">
                        </div>
                        <div class="layui-form-item">
                            <div id="slider2" class="slider"></div>
                        </div>
                        <div class="layui-form-item">
                            <button type="button" class="layui-btn layui-btn-fluid layui-btn-disabled" id="register">注册</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
</body>
<!-- 初始化方法 -->
<script>
    var valiflag = false;
    var slidflag = false;
    var layer = layui.layer;
    var index = parent.layer.getFrameIndex(window.name);
</script>
<!--数据验证-->
<script type="text/javascript">

    $(function () {
        $("#register_form").validate({
            onfocusout: function (element) { $(element).valid(); },
            rules: {
                username: {
                    required: true,
                    rangelength: [6, 11],
                    isContainsSpecialChar: true,
                    remote: "http://localhost:8080/toup/user/repetition"
                },
                password: {
                    required: true,
                    rangelength: [6, 11]
                },
                aginpassword: {
                    required: true,
                    rangelength: [6, 11],
                    equalpass: true
                },
                name: {
                    required: true
                },
                phone: {
                    required: true,
                    isMobile: true
                },
                email: {
                    required: true,
                    email: true
                }
            },
            messages:{
                username: {
                    remote: "用户名重复"
                }   
            },
            showErrors: function (errorMap, errorList) {
                if (this.numberOfInvalids() != 0) {
                    valiflag = false;
                } else if (this.numberOfInvalids() == 0) {
                    valiflag = true;
                }
                this.defaultShowErrors();
            }
        });
    });
</script>
<!--判断两次密码是否一致-->


<!-- 滑块验证码 -->
<script>

    $("#slider2").slider({
        width: 590, // width
        height: 40, // height
        sliderBg: "rgb(134, 134, 131)", // 滑块背景颜色
        color: "#fff", // 文字颜色
        fontSize: 14, // 文字大小
        bgColor: "#33CC00", // 背景颜色
        textMsg: "按住滑块，拖拽验证", // 提示文字
        successMsg: "验证通过了哦", // 验证成功提示文字
        successColor: "white", // 滑块验证成功提示文字颜色
        time: 400, // 返回时间
        callback: function (result) { // 回调函数，true(成功),false(失败)
            if (result) {
                slidflag = true;
            }
        }
    });
</script>
<!-- 验证通过 -->
<script>
    setInterval(function () {
        if (slidflag && valiflag) {
            // $("#register").get(0).setAttribute("type", "submit");
            $("#register").removeClass("layui-btn-disabled");
        } else {
            // $("#register").get(0).setAttribute("type", "button");
            $("#register").addClass("layui-btn-disabled");
        }
    }, 1000);
</script>
<!-- 提交方法 -->
<script>
    $(function () {
        $("#register").click(
            function () {
                if (slidflag && valiflag) {
                    $.ajax({
                        type: 'POST',
                        dataType: 'json',
                        url: 'http://localhost:8080/toup/user/register',
                        data: $("#register_form").serializeArray(),
                        contentType: "application/x-www-form-urlencoded",
                        success: function (data) {
                            console.log(data);
                            console.log("success");
                            if (data.code == 0) {
                                parent.layer.msg('注册成功');
                                parent.layer.close(index);   
                            }else{
                                parent.layer.msg(data.msg);
                            }
                        }
                    });
                }
            }
        );
    });
</script>

</html>